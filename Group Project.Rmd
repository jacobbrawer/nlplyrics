---
title: "Group Project"
author: "Will Abele, Jacob Brawer, Owen Rosebeck"
date: 'Wednesday, December 18'
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tm)
library(tidyverse)
songs <- read.csv("prepped_data.csv")
stopWords <- c("chorus ", "verse ")

songs <- songs %>% 
  select(Album, Artist, Lyrics, Rank, Song.Title, Year, Verbs, Nouns, Adverbs, Word.Counts) %>%
  mutate(Lyrics = as.character(Lyrics)) %>% 
  mutate(Verbs = as.character(Verbs)) %>% 
  mutate(Nouns = as.character(Nouns)) %>% 
  mutate(Adverbs = as.character(Adverbs)) %>% 
  mutate(Nouns = removeWords(Nouns, stopWords)) %>%
  mutate(Decade = ifelse(Year < 1980, 70, ifelse(Year < 1990, 80, ifelse(Year < 2000, 90, ifelse(Year < 2010, 00, 10)))))

```


```{r}
library(tidyverse)
library(stringr)
library(wordcloud2)
library(tidytext)

songtoken <- songs %>%
  select(Nouns) %>%
  unnest_tokens(output = word, input = Nouns)

song_tidy <- songtoken %>% 
  group_by(word) %>%
  count() %>% 
  arrange(desc(n))

wordcloud2(data = song_tidy[1:100,], size = 1, color = "RED")
```


```{r}
songs70 <- songs %>%
  filter(Decade == 70)

songs80 <- songs %>%
  filter(Decade == 80)

songs90 <- songs %>%
  filter(Decade == 90)

songs00 <- songs %>%
  filter(Decade == 0)

songs10 <- songs %>%
  filter(Decade == 10)

yearlist <- c(1970:2019)

top10 <- c()
for(i in c(1:10)){
  top10 <- c(top10, song_tidy[i, 1])
}

masterwordlist <- data.frame()


for (i in yearlist){
  
yearsongtoken <- songs %>%
  filter(Year == i) %>%
  select(Nouns) %>%
  unnest_tokens(output = word, input = Nouns)

year_song_tidy <- yearsongtoken %>% 
  filter(word == top10[1] | word == top10[2] | word == top10[3] |word == top10[4] |word == top10[5] |word == top10[6] |word == top10[7] |word == top10[8] |word == top10[9] |word == top10[10]) %>%
  group_by(word) %>%
  count() %>% 
  arrange(desc(n)) %>%
  mutate(Year = i)

if (length(masterwordlist) == 0 ){
  masterwordlist <- year_song_tidy 
}else{
  
masterwordlist <- merge(year_song_tidy, masterwordlist, all = TRUE)
  }
}

```


```{r}

songtoken70 <- songs70 %>%
  select(Song.Title, Nouns) %>%
  unnest_tokens(output = word, input = Nouns)

song_tidy70 <- songtoken70 %>% 
  group_by(word) %>%
  count() %>% 
  arrange(desc(n))

wordcloud2(data = song_tidy70[1:100,], size = 1, color = "RED")


songtoken80 <- songs80 %>%
  select(Song.Title, Nouns) %>%
  unnest_tokens(output = word, input = Nouns)

song_tidy80 <- songtoken80 %>% 
  group_by(word) %>%
  count() %>% 
  arrange(desc(n))

wordcloud2(data = song_tidy80[1:100,], size = 1, color = "RED")


songtoken90 <- songs90 %>%
  select(Song.Title, Nouns) %>%
  unnest_tokens(output = word, input = Nouns)

song_tidy90 <- songtoken90 %>% 
  group_by(word) %>%
  count() %>% 
  arrange(desc(n))

wordcloud2(data = song_tidy90[1:100,], size = 1, color = "RED")



songtoken00 <- songs00 %>%
  select(Song.Title, Nouns) %>%
  unnest_tokens(output = word, input = Nouns)

song_tidy00 <- songtoken00 %>% 
  group_by(word) %>%
  count() %>% 
  arrange(desc(n))

wordcloud2(data = song_tidy00[1:100,], size = 1, color = "RED")



songtoken10 <- songs10 %>%
  select(Song.Title, Nouns) %>%
  unnest_tokens(output = word, input = Nouns)

song_tidy10 <- songtoken10 %>% 
  group_by(word) %>%
  count() %>% 
  arrange(desc(n))

wordcloud2(data = song_tidy10[1:100,], size = 1, color = "RED")


```


```{r}
# top10 <- c()
# for(i in c(1:10)){
#   top10 <- c(top10, song_tidy[i, 1])
# }
# 
# songs70pop <- song_tidy70 %>%
#   filter(word == top10[1] | word == top10[2] | word == top10[3] |word == top10[4] |word == top10[5] |word == top10[6] |word == top10[7] |word == top10[8] |word == top10[9] |word == top10[10]) %>%
#   mutate(Decade = 1970)
# 
# songs80pop <- song_tidy80 %>%
#   filter(word == top10[1] | word == top10[2] | word == top10[3] |word == top10[4] |word == top10[5] |word == top10[6] |word == top10[7] |word == top10[8] |word == top10[9] |word == top10[10]) %>%
#   mutate(Decade = 1980)
# 
# songs90pop <- song_tidy90 %>%
#   filter(word == top10[1] | word == top10[2] | word == top10[3] |word == top10[4] |word == top10[5] |word == top10[6] |word == top10[7] |word == top10[8] |word == top10[9] |word == top10[10]) %>%
#   mutate(Decade = 1990)
# 
# songs00pop <- song_tidy00 %>%
#   filter(word == top10[1] | word == top10[2] | word == top10[3] |word == top10[4] |word == top10[5] |word == top10[6] |word == top10[7] |word == top10[8] |word == top10[9] |word == top10[10]) %>%
#   mutate(Decade = 2000)
# 
# songs10pop <- song_tidy10 %>%
#   filter(word == top10[1] | word == top10[2] | word == top10[3] |word == top10[4] |word == top10[5] |word == top10[6] |word == top10[7] |word == top10[8] |word == top10[9] |word == top10[10]) %>%
#   mutate(Decade = 2010)
```



```{r}
ggplot(masterwordlist, aes(x = Year, y = n, color = word)) + geom_line()

```
```{r}
library(gplots)
library(dplyr)

arrangedmasterwordlist <- masterwordlist %>%
  group_by(word) %>%
  arrange((Year))

widemasterwordlist <- data.frame(pivot_wider(arrangedmasterwordlist, id_cols = word, names_from = Year, values_from = n))
row.names(widemasterwordlist) <- widemasterwordlist$word
masterwordmatrix <- data.matrix(widemasterwordlist[,-1])

wordheatmap <- heatmap(masterwordmatrix, Rowv = NA, Colv = NA, col = heat.colors(256), scale = "column", margins = c(5, 10))
```
```{r}
library(dplyr) #Data manipulation (also included in the tidyverse package)
library(tidyr) #Spread, separate, unite, text mining (also included in the tidyverse package)
library(widyr) #Use for pairwise correlation

#Visualizations!
library(ggplot2) #Visualizations (also included in the tidyverse package)
library(ggrepel) #`geom_label_repel`
library(gridExtra) #`grid.arrange()` for multi-graphs
library(knitr) #Create nicely formatted output tables
library(kableExtra) #Create nicely formatted output tables
library(formattable) #For the color_tile function
library(circlize) #Visualizations - chord diagram
library(remotes)
install_github("EmilHvitfeldt/textdata")
install_github("juliasilge/tidytext")
library(tidytext) #Text mining
library(textdata)

# tidytext::sentiment
# 
# 
# afinn <- get_sentiments("afinn")
# bing <- get_sentiments("bing")
# nrc <- get_sentiments("nrc")
# 
# 
# view(sentiments)
# 
# new_sentiments <- sentiments %>% #From the tidytext package
#   filter(lexicon != "loughran") %>% #Remove the finance lexicon
#   mutate( sentiment = ifelse(lexicon == "AFINN" & score >= 0, "positive",
#                               ifelse(lexicon == "AFINN" & score < 0,
#                                      "negative", sentiment))) %>%
#   group_by(lexicon) %>%
#   mutate(words_in_lexicon = n_distinct(word)) %>%
#   ungroup()
# 
# new_sentiments %>%
#   group_by(lexicon, sentiment, words_in_lexicon) %>%
#   summarise(distinct_words = n_distinct(word)) %>%
#   ungroup() %>%
#   spread(sentiment, distinct_words) %>%
#   mutate(lexicon = color_tile("lightblue", "lightblue")(lexicon),
#          words_in_lexicon = color_bar("lightpink")(words_in_lexicon)) %>%
#   my_kable_styling(caption = "Word Counts Per Lexicon")



```











